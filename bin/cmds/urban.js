"use strict";var themes=require("../themes"),tools=require("../tools"),_=require("lodash"),chalk=require("chalk"),needle=require("needle"),noon=require("noon"),CFILE=process.env.HOME+"/.leximaven.noon";exports.command="urban <query>",exports.desc="Urban Dictionary definitions",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},limit:{alias:"l",desc:"Limit number of results","default":5,type:"number"}},exports.handler=function(e){tools.checkConfig(CFILE);var o=noon.load(CFILE),r={urban:{limit:e.l}};o.merge&&(o=_.merge({},o,r));var n=themes.loadTheme(o.theme);o.verbose&&themes.labelDown("Urban Dictionary",n,null);var t=[];if(t.push(e.query),e._.length>1)for(var i=1;i<=e._.length-1;i++)t.push(e._[i]);var a="";a=t.length>1?t.join("+"):t[0];var l="http://api.urbandictionary.com/v0/define?term="+a;l=encodeURI(l);var s={type:"urban",source:"http://www.urbandictionary.com"};needle.get(l,function(r,t){if(r||200!==t.statusCode)console.error(chalk.red.bold("HTTP "+t.statusCode+":")+" "+chalk.red(r));else{for(var i=o.urban.limit,a=t.body.list.slice(0,i),l=0;l<=a.length-1;l++){var u=a[l];themes.labelDown("Definition",n,u.definition),s[["definition"+l]]=u.definition}e.o&&tools.outFile(e.o,e.f,s),e.s&&o.merge&&noon.save(CFILE,o),e.s&&!o.merge&&console.err(chalk.red("Set option merge to true!"))}})};