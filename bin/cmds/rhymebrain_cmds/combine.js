"use strict";var themes=require("../../themes"),tools=require("../../tools"),_=require("lodash"),chalk=require("chalk"),needle=require("needle"),noon=require("noon"),CFILE=process.env.HOME+"/.leximaven.noon";exports.command="combine <query>",exports.desc="Rhymebrain portmanteaus",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},lang:{alias:"l",desc:"ISO 639-1 language code","default":"en",type:"string"},max:{alias:"m",desc:"Max results to return","default":5,type:"number"}},exports.handler=function(e){tools.checkConfig(CFILE);var o=noon.load(CFILE),r={combine:{lang:e.l,max:e.m}};o.merge&&(o=_.merge({},o,r));var a=themes.loadTheme(o.theme);o.verbose&&themes.labelDown("Rhymebrain",a,null);var t=e.query,n="Portmanteaus",l="http://rhymebrain.com/talk?function=get",s=""+l+n+"&word="+t+"&",i=[];i.push("lang="+o.combine.lang+"&"),i.push("maxResults="+o.combine.max+"&");var m=i.join(""),u=""+s+m;u=encodeURI(u),themes.labelDown("Portmanteaus",a,null);var c={type:"portmanteau",source:"http://rhymebrain.com"};needle.get(u,function(r,t){if(r||200!==t.statusCode)console.error(chalk.red.bold("HTTP "+t.statusCode+":")+" "+chalk.red(r));else{for(var n=t.body,l=0;l<=n.length-1;l++){var s=n[l];themes.labelRight(s.source,a,s.combined),c[["source"+l]]=s.source,c[["portmanteau"+l]]=s.combined}e.o&&tools.outFile(e.o,e.f,c),e.s&&o.merge&&noon.save(CFILE,o),e.s&&!o.merge&&console.err(chalk.red("Set option merge to true!"))}})};