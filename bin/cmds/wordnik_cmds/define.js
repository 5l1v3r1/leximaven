"use strict";var themes=require("../../themes"),tools=require("../../tools"),_=require("lodash"),chalk=require("chalk"),needle=require("needle"),noon=require("noon"),CFILE=process.env.HOME+"/.leximaven.noon";exports.command="define <word>",exports.desc="Wordnik definitions",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},limit:{alias:"l",desc:"Limit number of results","default":5,type:"number"},canon:{alias:"c",desc:"Use canonical","default":!1,type:"boolean"},defdict:{alias:"d",desc:"CSV list of dictionaries or 'all'","default":"all",type:"string"},part:{alias:"p",desc:"CSV list of parts of speech. See http://developer.wordnik.com/docs.html for list of parts.","default":"",type:"string"}},exports.handler=function(e){tools.checkConfig(CFILE);var o=noon.load(CFILE),t={define:{canon:e.c,limit:e.l,defdict:e.d,part:e.p}};o.merge&&(o=_.merge({},o,t));var s=themes.loadTheme(o.theme);o.verbose&&themes.labelDown("Wordnik",s,null);var n=e.word,i="definitions",r="http://api.wordnik.com:80/v4/word.json/",l=process.env.WORDNIK,a=""+r+n+"/"+i+"?",c=[];c.push("useCanonical="+o.define.canon+"&"),c.push("sourceDictionaries="+o.define.defdict+"&"),c.push("includeRelated=false&"),c.push("includeTags=false&"),c.push("limit="+o.define.limit+"&"),c.push("partOfSpeech="+o.define.part+"&"),c.push("api_key="+l);var d=c.join(""),p=""+a+d;p=encodeURI(p);var u={type:"definition",source:"http://www.wordnik.com"},f=_.get(chalk,s.connector.style),h=_.get(chalk,s.content.style),m=_.get(chalk,s.content.style+".underline"),g=f(s.connector.str);needle.get(p,function(t,n){if(t||200!==n.statusCode)console.error(chalk.red.bold("HTTP "+n.statusCode+":")+" "+chalk.red(t));else{for(var i=n.body,r=0;r<=i.length-1;r++){var l=i[r],a=[];a.push(h(l.text+" ")),a.push(m(l.partOfSpeech)),a.push(g),a.push(h(l.sourceDictionary)),themes.labelRight("Definition",s,a.join("")),u[["text"+r]]=l.text,u[["deftype"+r]]=l.partOfSpeech,u[["source"+r]]=l.sourceDictionary}e.o&&tools.outFile(e.o,e.f,u),e.s&&o.merge&&noon.save(CFILE,o),e.s&&!o.merge&&console.err(chalk.red("Set option merge to true!"))}})};