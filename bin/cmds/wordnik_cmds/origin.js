"use strict";var themes=require("../../themes"),tools=require("../../tools"),_=require("lodash"),chalk=require("chalk"),needle=require("needle"),noon=require("noon"),xml2js=require("xml2js"),CFILE=process.env.HOME+"/.leximaven.noon";exports.command="origin <word>",exports.desc="Wordnik etymologies",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},canon:{alias:"c",desc:"Use canonical","default":!1,type:"boolean"}},exports.handler=function(e){tools.checkConfig(CFILE);var o=noon.load(CFILE),r={origin:{canon:e.c}};o.merge&&(o=_.merge({},o,r));var n=themes.loadTheme(o.theme);o.verbose&&themes.labelDown("Wordnik",n,null);var s=e.word,t="etymologies",l="http://api.wordnik.com:80/v4/word.json/",a=process.env.WORDNIK,i=""+l+s+"/"+t+"?",c=[];c.push("useCanonical="+o.origin.canon+"&"),c.push("api_key="+a);var d=c.join(""),m=""+i+d;m=encodeURI(m);var u=new xml2js.Parser,g={type:"etymology",source:"http://www.wordnik.com"},h=_.get(chalk,n.content.style);needle.get(m,function(r,s){if(r||200!==s.statusCode)console.error(chalk.red.bold("HTTP "+s.statusCode+":")+" "+chalk.red(r));else{var t=s.body,l=t[0];u.parseString(l,function(e,o){var r=o.ety,s=r._,t=r.ets;t=t.join(", "),themes.labelRight("Etymology",n,h(s+" "+t)),g.etymology=s,g.origin=t}),e.o&&tools.outFile(e.o,e.f,g),e.s&&o.merge&&noon.save(CFILE,o),e.s&&!o.merge&&console.err(chalk.red("Set option merge to true!"))}})};