"use strict";var themes=require("../../themes"),tools=require("../../tools"),_=require("lodash"),chalk=require("chalk"),needle=require("needle"),noon=require("noon"),xml2js=require("xml2js"),CFILE=process.env.HOME+"/.leximaven.noon";exports.command="origin <word>",exports.desc="Wordnik etymologies",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},canon:{alias:"c",desc:"Use canonical","default":!1,type:"boolean"}},exports.handler=function(e){tools.checkConfig(CFILE);var o=noon.load(CFILE),r={origin:{canon:e.c}};o.prefer&&(o=_.merge({},o,r));var s=themes.loadTheme(o.theme);o.verbose&&themes.labelDown("Wordnik",s,null);var n=e.word,t="etymologies",l="http://api.wordnik.com:80/v4/word.json/",a=process.env.WORDNIK,i=""+l+n+"/"+t+"?",c=[];c.push("useCanonical="+e.c+"&"),c.push("api_key="+a);var d=c.join(""),u=""+i+d;u=encodeURI(u);var m=new xml2js.Parser,p={type:"etymology",source:"http://www.wordnik.com"},h=_.get(chalk,s.content.style);needle.get(u,function(r,n){if(r||200!==n.statusCode)console.error(chalk.red.bold("HTTP "+n.statusCode+":")+" "+chalk.red(r));else{var t=n.body,l=t[0];m.parseString(l,function(e,o){var r=o.ety,n=r._,t=r.ets;t=t.join(", "),themes.labelRight("Etymology",s,h(n+" "+t)),p.etymology=n,p.source=t}),e.o&&tools.outFile(e.o,e.f,p),e.s&&o.prefer&&noon.save(CFILE,o)}})};