"use strict";var themes=require("../themes"),tools=require("../tools"),_=require("lodash"),chalk=require("chalk"),noon=require("noon"),ora=require("ora"),xray=require("x-ray"),CFILE=process.env.HOME+"/.leximaven.noon",langs=["english","english-obscure","german","spanish","esperanto","french","italian","latin","dutch","portuguese","swedish","names"];exports.command="anagram <query>",exports.desc="Wordsmith anagrams",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},"case":{alias:"c",desc:"0 - lowercase, 1 - First Letter, 2 - UPPERCASE","default":1,type:"number"},exclude:{alias:"e",desc:"Anagrams must exclude this word","default":"",type:"string"},include:{alias:"i",desc:"Anagrams must include this word","default":"",type:"string"},lang:{alias:"a",desc:langs.join(", "),"default":"english",type:"string"},linenum:{alias:"u",desc:"Show line numbers with anagrams","default":!1,type:"boolean"},list:{alias:"l",desc:"Show candidate word list only","default":!1,type:"boolean"},limit:{alias:"t",desc:"Limit number of results","default":10,type:"number"},minletter:{alias:"n",desc:"Minimum letters in each word","default":1,type:"number"},maxletter:{alias:"x",desc:"Maximum letters in each word","default":50,type:"number"},maxword:{alias:"w",desc:"Maximum words in each anagram","default":10,type:"number"},repeat:{alias:"r",desc:"Repeat occurences of a word OK","default":!1,type:"boolean"}},exports.handler=function(e){tools.checkConfig(CFILE);var a=noon.load(CFILE),s={anagram:{"case":e.c,lang:e.a,linenum:e.u,list:e.l,limit:e.t,minletter:e.n,maxletter:e.x,maxword:e.w,repeat:e.r}};a.prefer&&(a=_.merge({},a,s));var n=themes.loadTheme(a.theme);a.verbose&&themes.labelDown("Wordsmith",n,null);var r="http://wordsmith.org/anagram/anagram.cgi?anagram=",t=e.query,l=""+r+t,o=[],i=a.anagram.repeat?"y":"n",u=a.anagram.list?"y":"n",m=a.anagram.linenum?"y":"n";o.push("&language="+a.anagram.lang),o.push("&t="+a.anagram.limit),o.push("&d="+a.anagram.maxword),o.push("&include="+e.i),o.push("&exclude="+e.e),o.push("&n="+a.anagram.minletter),o.push("&m="+a.anagram.maxletter),o.push("&a="+i),o.push("&l="+u),o.push("&q="+m),o.push("&k="+a.anagram["case"]),o.push("&src=adv");var d=o.join(""),c=""+l+d;c=encodeURI(c);var p={type:"anagram",source:"http://wordsmith.org/"},g=_.get(chalk,n.content.style),h=ora({text:""+chalk.bold.cyan("Loading anagrams..."),spinner:"dots8",color:"yellow"});h.start();var f=xray();f(c,{p:".p402_premium"})(function(s,r){if(h.stop(),h.clear(),/Input[a-z0-9 \(\)\.']*/i.test(r.p)){var l=r.p.match(/(Input[a-z0-9 \(\)\.']*)/i),o=l[1];o=o.replace(/letters\.Please/i,"letters.\nPlease"),console.log(chalk.red(o))}else if(/No anagrams found/i.test(r.p))console.log(g("No anagrams found."));else{var i=r.p.match(/(\d*) found\. Displaying ([a-z0-9 ]*):([a-z\s]*)document/i),u=i[1],m=i[2],d=i[3].trim();themes.labelDown("Anagrams",n,null),console.log(g("Anagrams for: "+t+"\n"+u+" found. Displaying "+m+":")),console.log(g(d)),p.found=u,p.show=m,p.alist=d.split("\n"),e.o&&tools.outFile(e.o,e.f,p),e.s&&a.prefer&&noon.save(CFILE,a)}})};