"use strict";var themes=require("../themes"),tools=require("../tools"),_=require("lodash"),chalk=require("chalk"),needle=require("needle"),noon=require("noon"),CFILE=process.env.HOME+"/.leximaven.noon";exports.command="dmuse <condition>",exports.desc="Datamuse query",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},max:{alias:"m",desc:"Maximum number of results, 1 to 1000","default":5,type:"number"}},exports.handler=function(e){tools.checkConfig(CFILE);var o=noon.load(CFILE),t={dmuse:{max:e.m}};o.prefer&&(o=_.merge({},o,t));var a=themes.loadTheme(o.theme);o.verbose&&themes.labelDown("Datamuse",a,null);var s=[];if(e._.length>1)for(var r=0;r<=e._.length-1;r++)s.push(e._[r]);var l="http://api.datamuse.com/words?",n="max="+o.dmuse.max+"&";_.each(s,function(e){n=n+"&"+e});var d=""+l+n;d=encodeURI(d);var i={n:"noun",adj:"adjective",adv:"adverb",syn:"synonym"},u={type:"datamuse",source:"http://datamuse.com/api"},c=_.get(chalk,a.content.style);needle.get(d,function(t,s){if(t||200!==s.statusCode)console.error(chalk.red.bold("HTTP "+s.statusCode+":")+" "+chalk.red(t));else{for(var r=s.body,l=0;l<=r.length-1;l++){var n=r[l];if(themes.labelRight("Match",a,n.word+" "),u[["match"+l]]=n.word,void 0!==n.tags&&n.tags!==[]){themes.labelRight("Tags",a,null);for(var d=0;d<=n.tags.length-1;d++)d===n.tags.length-1?(process.stdout.write(c(""+i[n.tags[d]])),u[["tags"+d]]=i[n.tags[d]]):process.stdout.write(c(i[n.tags[d]]+", "));console.log("")}}e.o&&tools.outFile(e.o,e.f,u),e.s&&o.prefer&&noon.save(CFILE,o)}})};