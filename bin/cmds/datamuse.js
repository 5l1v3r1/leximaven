"use strict";var themes=require("../themes"),tools=require("../tools"),_=require("lodash"),chalk=require("chalk"),needle=require("needle"),noon=require("noon"),CFILE=process.env.HOME+"/.leximaven.noon";exports.command="dmuse <condition>",exports.desc="Datamuse query",exports.builder={out:{alias:"o",desc:"Write cson, json, noon, plist, yaml, xml","default":"",type:"string"},force:{alias:"f",desc:"Force overwriting outfile","default":!1,type:"boolean"},save:{alias:"s",desc:"Save flags to config file","default":!1,type:"boolean"},max:{alias:"m",desc:"Maximum number of results, 1 to 1000","default":5,type:"number"}},exports.handler=function(e){tools.checkConfig(CFILE);var o=noon.load(CFILE),t={dmuse:{max:e.m}};o.merge&&(o=_.merge({},o,t));var a=themes.loadTheme(o.theme);o.verbose&&themes.labelDown("Datamuse",a,null);var s=[];if(s.push(e.condition),e._.length>1)for(var r=1;r<=e._.length-1;r++)s.push(e._[r]);var n="http://api.datamuse.com/words?",l="max="+o.dmuse.max+"&";_.each(s,function(e){l=l+"&"+e});var d=""+n+l;d=encodeURI(d);var i={n:"noun",adj:"adjective",adv:"adverb",syn:"synonym"},u={type:"datamuse",source:"http://datamuse.com/api"},m=_.get(chalk,a.content.style);needle.get(d,function(t,s){if(t||200!==s.statusCode)console.error(chalk.red.bold("HTTP "+s.statusCode+":")+" "+chalk.red(t));else{for(var r=s.body,n=0;n<=r.length-1;n++){var l=r[n];if(themes.labelRight("Match",a,l.word+" "),u[["match"+n]]=l.word,void 0!==l.tags&&l.tags!==[]){themes.labelRight("Tags",a,null);for(var d=0;d<=l.tags.length-1;d++)d===l.tags.length-1?(process.stdout.write(m(""+i[l.tags[d]])),u[["tags"+d]]=i[l.tags[d]]):process.stdout.write(m(i[l.tags[d]]+", "));console.log("")}}e.o&&tools.outFile(e.o,e.f,u),e.s&&o.merge&&noon.save(CFILE,o),e.s&&!o.merge&&console.err(chalk.red("Set option merge to true!"))}})};